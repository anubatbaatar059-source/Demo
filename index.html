<!doctype html>
<html lang="mn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
  <title>Minimal — Browser Camera Only</title>
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    /* Камерын фийдийг бүтэн дэлгэцээр */
    #cam{
      position:fixed; inset:0; width:100vw; height:100vh;
      object-fit:cover; background:#000;
      /* Хэрэв урд камер хэрэглэвэл доорхыг авч болно */
      /* transform: scaleX(-1); */
    }
    #dbg{
      position:fixed; left:8px; top:8px; z-index:10;
      color:#0f0; font:12px/1 monospace; background:rgba(0,0,0,.45);
      padding:6px 8px; border-radius:6px; white-space:pre;
    }
    #tap{
      position:fixed; inset:0; display:none; place-items:center;
      background:#000; z-index:9;
    }
    .btn{padding:12px 16px; border:0; border-radius:12px; font-weight:700; cursor:pointer}
  </style>
</head>
<body>
  <div id="dbg">boot…</div>
  <div id="tap"><button class="btn">▶ Камер нээх</button></div>
  <video id="cam" playsinline autoplay muted></video>

<script>
const dbg = (m)=>document.getElementById('dbg').textContent = m;

let stream = null;
const camEl = document.getElementById('cam');
const tapEl = document.getElementById('tap');

async function startCamera() {
  dbg('requesting permission…');
  // Зөвшөөрөл: арын камер илүүд үзнэ
  stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: { ideal: 'environment' },
      width: { ideal: 1280 }, height: { ideal: 720 }
    },
    audio: false
  });
  camEl.srcObject = stream;
  await camEl.play().catch(()=>{}); // iOS дээр заримдаа шаардлагатай
  dbg('camera started');
}

function stopCamera() {
  if (!stream) return;
  for (const t of stream.getTracks()) t.stop();
  stream = null;
  camEl.srcObject = null;
  dbg('camera stopped');
}

// Эхлүүлэх оролдлого
document.addEventListener('DOMContentLoaded', async () => {
  if (!navigator.mediaDevices?.getUserMedia) {
    dbg('getUserMedia not supported'); return;
  }
  try {
    await startCamera();
  } catch (e) {
    // Хэрэв gesture шаардвал (iOS г.м.)
    tapEl.style.display = 'grid';
    dbg('tap to start');
  }
});

// Gesture fallback
tapEl.addEventListener('click', async () => {
  tapEl.style.display = 'none';
  try { await startCamera(); }
  catch (e) { dbg('failed: ' + (e?.message || e)); }
});

// App visibility-д тулгуурласан start/pause
document.addEventListener('visibilitychange', async () => {
  try {
    if (document.hidden) stopCamera();
    else if (!stream) await startCamera();
  } catch (e) { dbg('visibility err: ' + (e?.message || e)); }
});

// Rotation/resize үед видео пропорц хадгална (CSS object-fit нь хангалттай)
addEventListener('resize', () => {/* no-op, CSS handles it */});
</script>
</body>
</html>
